<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多数傷病者対応訓練</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8f9fa;
        }
       .section-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
       .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s, color 0.3s;
            cursor: pointer;
            color: #4b5563;
        }
       .nav-link.active {
            background-color: #1e40af;
            color: white;
            font-weight: 700;
        }
       .flowchart-step {
            border: 2px solid #e5e7eb;
            padding: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
       .flowchart-step:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
       .flowchart-step .details {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
        }
       .flowchart-arrow {
            font-size: 2rem;
            color: #9ca3af;
        }
       .triage-tag {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
        }
       .triage-tag:hover {
            transform: scale(1.05);
        }
       .tag-red { background-color: #ef4444; color: white; }
       .tag-yellow { background-color: #f59e0b; color: white; }
       .tag-green { background-color: #22c55e; color: white; }
       .tag-black { background-color: #374151; color: white; }
       .feedback-correct { color: #22c55e; }
       .feedback-incorrect { color: #ef4444; }
       .venue-map-item {
            border: 2px dashed #9ca3af;
            padding: 1rem;
            text-align: center;
            border-radius: 0.5rem;
            font-weight: bold;
        }
       .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: auto;
            max-height: 400px;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-blue-800">多数傷病者対応訓練</h1>
            <div class="hidden md:flex space-x-2">
                <a href="#intro" class="nav-link">はじめに</a>
                <a href="#basics" class="nav-link">基礎知識</a>
                <a href="#flow" class="nav-link">初動対応フロー</a>
                <a href="#drill" class="nav-link">トリアージ訓練</a>
                <a href="#scenario" class="nav-link">岡崎市シナリオ</a>
                <a href="#hospitals" class="nav-link">近隣医療機関</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <a href="#intro" class="block py-2 px-4 text-sm nav-link">はじめに</a>
            <a href="#basics" class="block py-2 px-4 text-sm nav-link">基礎知識</a>
            <a href="#flow" class="block py-2 px-4 text-sm nav-link">初動対応フロー</a>
            <a href="#drill" class="block py-2 px-4 text-sm nav-link">トリアージ訓練</a>
            <a href="#scenario" class="block py-2 px-4 text-sm nav-link">岡崎市シナリオ</a>
            <a href="#hospitals" class="block py-2 px-4 text-sm nav-link">近隣医療機関</a>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <section id="intro" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">はじめに：大規模イベントに備えて</h2>
            <p class="mb-4">
                本教育資料は、消防署に勤務する救急救命士を対象とし、多数傷病者発生事案における標準的な初動対応能力の向上を目的としています。
            </p>
            <p>
                特に、2026年に開催される愛知・名古屋アジアパラ競技大会では、岡崎市も競技会場の一つとなります。国内外から多くの人々が集まる大規模イベントでは、万が一の事態に備え、迅速かつ組織的な対応が求められます。このアプリケーションを通じて、基礎知識の再確認と、具体的なシナリオを想定したシミュレーションを行い、万全の体制を整えましょう。
            </p>
        </section>

        <section id="basics" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">基礎知識：多数傷病者対応の原則</h2>
            <p class="mb-6">多数傷病者対応とは、単一の事故や災害で、地域の医療供給能力を上回る数の傷病者が発生した状態への対応を指します。限られた医療資源を最大限に活用し、救命率の向上を目指すことが最大の目標です。「防ぎ得た災害死」をなくすため、以下の原則に基づき活動します。</p>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2 text-blue-800">CSCA TTT フレームワーク</h3>
                    <p class="text-sm">現場活動を体系的に進めるための指揮・管理の枠組みです。</p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li><strong>C</strong> - Command & Control（指揮・統制）</li>
                        <li><strong>S</strong> - Safety（安全確保）</li>
                        <li><strong>C</strong> - Communication（情報伝達・通信）</li>
                        <li><strong>A</strong> - Assessment（状況評価）</li>
                        <li><strong>T</strong> - Triage（トリアージ）</li>
                        <li><strong>T</strong> - Treatment（治療）</li>
                        <li><strong>T</strong> - Transport（搬送）</li>
                    </ul>
                </div>
                <div class="bg-amber-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2 text-amber-800">トリアージとは</h3>
                    <p class="text-sm">傷病者の重症度と緊急性に基づき、治療と搬送の優先順位を決定することです。START法（Simple Triage and Rapid Treatment）が一般的に用いられます。</p>
                    <div class="mt-3 grid grid-cols-2 gap-2">
                        <div class="flex items-center"><span class="tag-red mr-2">🔴</span>第I順位（最優先治療群）</div>
                        <div class="flex items-center"><span class="tag-yellow mr-2">🟡</span>第II順位（待機的治療群）</div>
                        <div class="flex items-center"><span class="tag-green mr-2">🟢</span>第III順位（軽処置群）</div>
                        <div class="flex items-center"><span class="tag-black mr-2">⚫️</span>第0順位（不処置群/死亡群）</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="flow" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">初動対応フロー：最初の10分間の行動</h2>
            <p class="mb-6">災害現場に最初に到着した救急隊（先着隊）の行動が、その後の活動全体を大きく左右します。以下のステップを確実に行いましょう。各ステップをクリックすると、詳細な行動内容と読み上げ原稿例が表示されます。</p>
            <div class="space-y-4">
                <div id="step1" class="flowchart-step">
                    <h3 class="font-bold text-lg">ステップ1：状況評価と安全確保 (Assessment & Safety)</h3>
                    <div class="details">
                        <p class="font-semibold">【行動内容】</p>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li>車両を安全な位置に停車させる（二次災害の危険がない場所、後続隊の妨げにならない場所）。</li>
                            <li>現場のハザード（火災、漏洩、崩壊など）を確認し、隊員の安全を最優先する。</li>
                            <li>風向、地形などを考慮する。</li>
                            <li>傷病者の概数を把握する（例：「10名以上」「約20名」）。</li>
                        </ul>
                        <p class="font-semibold mt-3">【読み上げ原稿例】</p>
                        <p class="text-sm p-2 bg-gray-100 rounded">『隊長、現場の安全確認。二次災害の危険なし。傷病者は広範囲に約20名。重傷者多数の模様。』</p>
                    </div>
                </div>
                <div class="text-center flowchart-arrow">⬇️</div>
                <div id="step2" class="flowchart-step">
                    <h3 class="font-bold text-lg">ステップ2：災害発生宣言と第一報 (Declaration & Communication)</h3>
                    <div class="details">
                        <p class="font-semibold">【行動内容】</p>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li>無線で「多数傷病者発生事案」であることを宣言する。</li>
                            <li>簡潔明瞭に、必要な情報を盛り込み第一報を送信する (すしあんじょうほうようばしょとり)。</li>
                            <li><strong>す</strong>: 種別 (事案の種別)</li>
                            <li><strong>し</strong>: 死傷者 (死傷者の概数)</li>
                            <li><strong>あん</strong>: 安全 (危険の有無、ハザード情報)</li>
                            <li><strong>じょう</strong>: 状況 (現場の活動状況、概要)</li>
                            <li><strong>ほう</strong>: 方針 (現場での活動方針)</li>
                            <li><strong>よう</strong>: 要請 (応援隊、DMAT等の要請)</li>
                            <li><strong>ばしょ</strong>: 場所 (発生場所、進入路、指揮本部位置)</li>
                            <li><strong>とり</strong>: トリアージ (トリアージ結果の概況)</li>
                        </ul>
                         <p class="font-semibold mt-3">【読み上げ原稿例】</p>
                        <p class="text-sm p-2 bg-gray-100 rounded">『こちら岡崎救急1、指令センター。岡崎市〇〇町、アジアパラ大会会場で多数傷病者事案発生。種別は爆発。二次災害の危険は今のところなし。国道1号線から進入可能。傷病者約20名。全救急隊、消防隊、DMATの出動を要請する。』</p>
                    </div>
                </div>
                <div class="text-center flowchart-arrow">⬇️</div>
                <div id="step3" class="flowchart-step">
                    <h3 class="font-bold text-lg">ステップ3：指揮本部と各エリアの設定 (Command & Control)</h3>
                    <div class="details">
                        <p class="font-semibold">【行動内容】</p>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li>先着隊の隊長が現場指揮官（IC）となる。</li>
                            <li>後続隊が視認しやすいように、指揮本部（CP）の位置を決定し、宣言する。</li>
                            <li>安全な場所に、トリアージエリア、救護所（赤・黄）、搬送エリアを設定する。</li>
                            <li>後続隊の集結場所（ステージングエリア）を指定する。</li>
                        </ul>
                        <p class="font-semibold mt-3">【読み上げ原稿例】</p>
                        <p class="text-sm p-2 bg-gray-100 rounded">『岡崎救急1が現場指揮官となる。指揮本部を車両位置に設置。後続隊は会場東側駐車場に集結せよ。』</p>
                    </div>
                </div>
                <div class="text-center flowchart-arrow">⬇️</div>
                <div id="step4" class="flowchart-step">
                    <h3 class="font-bold text-lg">ステップ4：トリアージの開始 (Triage)</h3>
                    <div class="details">
                        <p class="font-semibold">【行動内容】</p>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li>原則として、先着隊の隊長は指揮に専念し、他の隊員がトリアージを開始する。</li>
                            <li>START法に基づき、迅速に評価を進める。「歩けるか？」「呼吸は？」「循環は？」「意識は？」</li>
                            <li>トリアージタッグを傷病者の右手首に装着する。</li>
                            <li>「赤」エリアへの搬送を優先的に開始する。</li>
                        </ul>
                         <p class="font-semibold mt-3">【読み上げ原稿例】</p>
                        <p class="text-sm p-2 bg-gray-100 rounded">『これよりトリアージを開始する。歩ける方はこちらの緑のシートに集まってください！』</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="drill" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">トリアージ訓練：START法に基づく判断</h2>
            <div id="triage-drill-wrapper">
                <div id="triage-question-view">
                    <p class="mb-6">以下の傷病者の状態を読み、適切なトリアージタッグを選択してください。</p>
                    <div id="triage-drill-container" class="space-y-6"></div>
                    <div class="text-center mt-6">
                        <button id="advance-drill-button" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition hidden">次へ</button>
                    </div>
                </div>
                <div id="triage-results-view" class="hidden text-center">
                    <h3 class="text-2xl font-bold mb-4">訓練結果</h3>
                    <div id="result-message" class="p-4 rounded-lg mb-2 font-bold text-lg"></div>
                    <p id="result-sub-message" class="mt-2 mb-4 text-gray-700"></p>
                    <p class="text-lg mb-2">正答数: <span id="final-score" class="font-bold"></span></p>
                    <p class="text-lg mb-4">所要時間: <span id="total-time" class="font-bold"></span></p>
                    <button id="restart-drill-button" class="font-bold py-2 px-6 rounded-lg transition text-white">もう一度挑戦</button>
                </div>
            </div>
        </section>

        <section id="scenario" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">岡崎市特設シナリオ：アジアパラ大会会場での事案発生</h2>
            <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-r-lg mb-6">
                <h3 class="font-bold">【事案概要】</h3>
                <p>岡崎中央総合公園 総合体育館、車いすバスケットボール競技の観客席エリアで原因不明の爆発が発生。多数の傷病者が発生している模様。</p>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-bold text-lg mb-2">特有の考慮事項</h3>
                    <ul class="list-disc list-inside space-y-2">
                        <li><strong>多様な傷病者:</strong> アスリート、観客、大会関係者など。特に、障がいを持つ方々への対応（コミュニケーション、移動補助）に配慮が必要。</li>
                        <li><strong>会場構造:</strong> 体育館の出入口、通路、避難経路を把握し、搬送ルートを迅速に確保する。</li>
                        <li><strong>情報錯綜:</strong> 大規模イベントのため、デマやパニックが発生しやすい。公式な情報伝達ルートを早期に確立する。</li>
                        <li><strong>通信:</strong> 携帯電話網の輻輳が予想されるため、消防無線が主要な通信手段となる。</li>
                    </ul>
                    <h3 class="font-bold text-lg mt-6 mb-2">想定される傷病者分布（ドーナツグラフ）</h3>
                    <p class="text-sm mb-4">このような大規模事案では、比較的軽症者が多くなる傾向がありますが、重症者への対応を最優先する必要があります。</p>
                    <div class="chart-container">
                        <canvas id="casualtyChart"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-2">現場活動エリア設定案</h3>
                    <p class="text-sm mb-4">体育館の構造と周辺地理を考慮したエリア設定例です。</p>
                    <div class="bg-gray-100 p-4 rounded-lg space-y-4">
                        <div class="venue-map-item bg-blue-100 border-blue-400">指揮本部 (CP) - 体育館正面入口付近</div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="venue-map-item bg-gray-200 border-gray-400">ステージングエリア - 第1駐車場</div>
                            <div class="venue-map-item bg-purple-100 border-purple-400">搬送待機エリア - 体育館東側</div>
                        </div>
                        <div class="venue-map-item bg-orange-100 border-orange-400">救護所（赤・黄エリア）- 体育館隣接の武道館</div>
                        <div class="venue-map-item bg-green-100 border-green-400">軽傷者エリア（緑エリア）- 弓道場前の広場</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="hospitals" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">岡崎市および近隣の主要救急医療機関</h2>
            <p class="mb-6">多数傷病者発生時には、指令センターの指示に基づき、各医療機関へ傷病者を分散搬送します。現場から比較的近く、三次救急や重症者対応が可能な主要機関を把握しておくことが重要です。</p>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="p-3 font-bold uppercase text-gray-600 border border-gray-300">医療機関名</th>
                            <th class="p-3 font-bold uppercase text-gray-600 border border-gray-300">所在地</th>
                            <th class="p-3 font-bold uppercase text-gray-600 border border-gray-300">現場からの距離(目安)</th>
                            <th class="p-3 font-bold uppercase text-gray-600 border border-gray-300">特記事項</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">岡崎市民病院</td>
                            <td class="p-3 border border-gray-300">岡崎市</td>
                            <td class="p-3 border border-gray-300">約6km</td>
                            <td class="p-3 border border-gray-300">地域救命救急センター（三次救急）</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">藤田医科大学 岡崎医療センター</td>
                            <td class="p-3 border border-gray-300">岡崎市</td>
                            <td class="p-3 border border-gray-300">約11km</td>
                            <td class="p-3 border border-gray-300">二次救急医療機関</td>
                        </tr>
                         <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">安城更生病院</td>
                            <td class="p-3 border border-gray-300">安城市</td>
                            <td class="p-3 border border-gray-300">約16km</td>
                            <td class="p-3 border border-gray-300">救命救急センター（三次救急）</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">トヨタ記念病院</td>
                            <td class="p-3 border border-gray-300">豊田市</td>
                            <td class="p-3 border border-gray-300">約19km</td>
                            <td class="p-3 border border-gray-300">救命救急センター（三次救急）</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">豊田厚生病院</td>
                            <td class="p-3 border border-gray-300">豊田市</td>
                            <td class="p-3 border border-gray-300">約20km</td>
                            <td class="p-3 border border-gray-300">救命救急センター（三次救急）</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white text-center py-4 mt-8">
        <p>&copy; 2025 消防署 救急課 教育資料</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Mobile Menu Toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // Smooth scrolling and active nav link highlighting
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('section');
            
            const activateLink = (id) => {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${id}`) {
                        link.classList.add('active');
                    }
                });
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        activateLink(entry.target.id);
                    }
                });
            }, { rootMargin: '-50% 0px -50% 0px' });

            sections.forEach(section => {
                observer.observe(section);
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    document.querySelector(targetId).scrollIntoView({
                        behavior: 'smooth'
                    });
                    if (mobileMenu.classList.contains('hidden') === false) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

            // Flowchart interaction
            const flowchartSteps = document.querySelectorAll('.flowchart-step');
            flowchartSteps.forEach(step => {
                step.addEventListener('click', () => {
                    const details = step.querySelector('.details');
                    const isVisible = details.style.display === 'block';
                    document.querySelectorAll('.flowchart-step .details').forEach(d => d.style.display = 'none');
                    details.style.display = isVisible? 'none' : 'block';
                });
            });
            
            // --- Triage Drill Logic ---
            const drillSetA = [
                { scenario: '10歳男性、呼びかけに開眼するが混乱。呼吸数28回/分。橈骨動脈は触知可。簡単な指示には従えない。', correct: 'red', explanation: '歩行不能で、簡単な指示に従えないため、精神状態の評価（Mental Status）で「赤」となります。' },
                { scenario: '30代女性、瓦礫の下から救出。自発呼吸なし。気道確保後も呼吸なし。', correct: 'black', explanation: '気道確保を行っても自発呼吸が再開しないため、「黒」と判断されます。' },
                { scenario: '40代男性、右足の開放骨折で激しく痛みを訴えている。呼吸数22回/分。橈骨動脈は触知可。指示に従える。', correct: 'yellow', explanation: '歩行はできないが、呼吸・循環・意識レベルの全てが基準内のため「黄」となります。' },
                { scenario: '20代女性、顔面に擦過傷のみ。パニック状態で泣いているが、「大丈夫、歩けます」と答える。', correct: 'green', explanation: '最初に「歩けるか？」と問いかけ、自力で歩行可能な傷病者は「緑」となります。実際に歩行できれば「緑」と判断します。' },
                { scenario: '70代男性、意識なし。自発呼吸あり、毎分36回。', correct: 'red', explanation: '呼吸数が毎分30回を超えているため、呼吸の評価（Breathing）で即座に「赤」と判断されます。' },
                { scenario: '6歳女児、呼びかけに反応なし。呼吸あり。橈骨動脈が触れにくく、CRTが3秒。', correct: 'red', explanation: '橈骨動脈が触知困難、またはCRTが2秒以上延長しているため、循環の評価（Perfusion）で「赤」となります。' },
                { scenario: '50代女性、広範囲の熱傷。意識あり、呼吸数25回/分。橈骨動脈触知可。指示にも従えるが歩行困難。', correct: 'yellow', explanation: '歩行不能ですが、呼吸・循環・意識の評価基準は全てクリアしているため「黄」と判断します。' },
                { scenario: '30代男性、頭部からの出血少量。自分で傷を押さえ、「歩けます」と返答し指示場所へ移動した。', correct: 'green', explanation: '自力で歩行し、指示された安全な場所へ移動できるため「緑」です。' },
                { scenario: '20代男性、胸部に鉄骨が刺さっている。意識はあるが、呼吸が速く浅い（40回/分）。', correct: 'red', explanation: '呼吸数が毎分30回を大幅に超えているため、呼吸の評価（Breathing）で即座に「赤」と判断されます。' },
                { scenario: '80代女性、呼びかけに反応なし。自発呼吸なし。気道確保すると呼吸が再開した。', correct: 'red', explanation: '気道確保によって呼吸が再開した場合は、生命の危機が差し迫っていると判断し「赤」となります。' }
            ];

            const drillSetB = [
                { scenario: '5歳男児、意識は朦朧としている。呼吸数40回/分と速い。', correct: 'red', explanation: '小児の場合、呼吸数が30回以上でも年齢によっては正常範囲ですが、意識が朦朧としているため最優先となります。PAT(小児評価トライアングル)でも異常。' },
                { scenario: '60代男性、大量に発汗し、胸痛を訴えている。呼吸・脈拍は正常範囲だが、歩行は困難。', correct: 'yellow', explanation: '急性心筋梗塞等が疑われますが、START法では呼吸・循環・意識が正常な歩行困難者は「黄」となります。ただし緊急度は高いと認識すべき症例です。' },
                { scenario: '10代女性、過呼吸で痺れを訴えている。呼吸数は速いが、会話は可能。自力で座っている。', correct: 'green', explanation: '歩行可能群に分類されます。パニック状態ですが、生命の危機は低いため「緑」です。' },
                { scenario: '30代男性、バイク事故。呼びかけにうめき声で反応。呼吸数18回/分、橈骨動脈は触知可能。簡単な指示には従えない。', correct: 'red', explanation: '簡単な指示に従えないため、意識レベルの評価で「赤」となります。' },
                { scenario: '70代女性、倒れているが意識は清明。「気分が悪い」と訴える。呼吸・循環は安定している。', correct: 'yellow', explanation: '歩行不能であり、バイタルが安定していても観察が必要なため「黄」となります。' },
                { scenario: '40代男性、腕に深い切り傷。出血は多いが、自分で圧迫している。顔面蒼白。橈骨動脈は弱く速い。', correct: 'red', explanation: '橈骨動脈が弱く速い（ショックの兆候）ため、循環の評価で「赤」となります。' },
                { scenario: '作業員男性、高所から転落。明らかに両足が変形。意識レベルは清明だが、激痛で動けない。', correct: 'yellow', explanation: '歩行不能ですが、呼吸・循環・意識は安定しているため「黄」です。' },
                { scenario: '90代男性、呼びかけ、痛み刺激に全く反応がない。呼吸も感じられない。頸動脈も触知不能。', correct: 'black', explanation: '無呼吸・無脈であり、救命困難と判断されるため「黒」となります。' },
                { scenario: '20代女性、泣きながら友人の名前を呼んでいる。軽度の擦り傷のみで、自力で歩き回っている。', correct: 'green', explanation: '自力歩行が可能であり、重篤な外傷がないため「緑」です。' },
                { scenario: '50代男性、咳き込み、呼吸困難を訴えている。チアノーゼが見られる。呼吸数32回/分。', correct: 'red', explanation: '呼吸数が30回/分を超え、チアノーゼも見られるため、呼吸の評価で「赤」となります。' }
            ];

            let score = 0;
            let currentQuestionIndex = 0;
            let startTime;
            let currentDrillSet;

            const questionView = document.getElementById('triage-question-view');
            const resultsView = document.getElementById('triage-results-view');
            const drillContainer = document.getElementById('triage-drill-container');
            const advanceDrillButton = document.getElementById('advance-drill-button');
            const restartDrillButton = document.getElementById('restart-drill-button');
            const finalScoreEl = document.getElementById('final-score');
            const totalTimeEl = document.getElementById('total-time');
            const resultMessageEl = document.getElementById('result-message');
            const resultSubMessageEl = document.getElementById('result-sub-message');
            
            function shuffle(array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            }

            function startDrill(questionSet) {
                score = 0;
                currentQuestionIndex = 0;
                currentDrillSet = shuffle([...questionSet]);
                startTime = new Date();

                resultsView.classList.add('hidden');
                questionView.classList.remove('hidden');
                
                loadQuestion(currentQuestionIndex);
            }

            function loadQuestion(index) {
                drillContainer.innerHTML = '';
                advanceDrillButton.classList.add('hidden');
                const item = currentDrillSet[index];
                
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-lg shadow';
                card.innerHTML = `
                    <p class="mb-4 font-bold">【症例 ${index + 1}/10】</p>
                    <p class="mb-4">${item.scenario}</p>
                    <div class="flex flex-wrap gap-2 justify-center button-container">
                        <button data-tag="red" class="triage-tag tag-red">🔴 最優先</button>
                        <button data-tag="yellow" class="triage-tag tag-yellow">🟡 待機的</button>
                        <button data-tag="green" class="triage-tag tag-green">🟢 軽処置</button>
                        <button data-tag="black" class="triage-tag tag-black">⚫️ 不処置</button>
                    </div>
                    <div class="feedback mt-4 text-center font-bold"></div>
                    <p class="explanation mt-2 text-sm bg-gray-50 p-3 rounded-lg hidden"></p>
                `;
                drillContainer.appendChild(card);
                
                card.querySelector('.button-container').addEventListener('click', (e) => {
                    if (e.target.matches('button')) {
                        const selectedTag = e.target.dataset.tag;
                        const feedbackEl = card.querySelector('.feedback');
                        const explanationEl = card.querySelector('.explanation');

                        if (selectedTag === item.correct) {
                            feedbackEl.textContent = '正解です！';
                            feedbackEl.className = 'feedback mt-4 text-center font-bold feedback-correct';
                            score++;
                        } else {
                            const correctTagName = {red: '最優先', yellow: '待機的', green: '軽処置', black: '不処置'}[item.correct];
                            feedbackEl.textContent = `不正解。正解は「${correctTagName}」です。`;
                            feedbackEl.className = 'feedback mt-4 text-center font-bold feedback-incorrect';
                        }
                        
                        explanationEl.textContent = item.explanation;
                        explanationEl.classList.remove('hidden');
                        
                        card.querySelectorAll('button').forEach(btn => btn.disabled = true);
                        advanceDrillButton.classList.remove('hidden');
                        if (currentQuestionIndex === currentDrillSet.length - 1) {
                            advanceDrillButton.textContent = '結果を見る';
                        } else {
                            advanceDrillButton.textContent = '次の問題へ';
                        }
                    }
                });
            }

            function showResults() {
                const endTime = new Date();
                const timeDiff = Math.round((endTime - startTime) / 1000);
                const minutes = Math.floor(timeDiff / 60);
                const seconds = timeDiff % 60;

                questionView.classList.add('hidden');
                resultsView.classList.remove('hidden');

                finalScoreEl.textContent = `${score} / ${currentDrillSet.length}`;
                totalTimeEl.textContent = `${minutes}分 ${seconds}秒`;
                
                if (score >= 9) {
                    resultMessageEl.textContent = "合格";
                    resultMessageEl.className = 'p-4 rounded-lg mb-2 font-bold text-lg bg-green-100 text-green-800';
                    resultSubMessageEl.textContent = '素晴らしい判断力です。さらに知識を深めるために、別の問題セットにも挑戦できます。';
                    restartDrillButton.textContent = '別の問題で再挑戦';
                    restartDrillButton.className = 'font-bold py-2 px-6 rounded-lg transition text-white bg-green-600 hover:bg-green-700';
                } else {
                    resultMessageEl.textContent = "要再訓練";
                    resultMessageEl.className = 'p-4 rounded-lg mb-2 font-bold text-lg bg-red-100 text-red-800';
                    resultSubMessageEl.textContent = '合格には9問以上の正解が必要です。下のボタンを押して、異なる問題で再試験を開始してください。';
                    restartDrillButton.textContent = '再試験を受ける';
                    restartDrillButton.className = 'font-bold py-2 px-6 rounded-lg transition text-white bg-orange-500 hover:bg-orange-600';
                }
            }
            
            advanceDrillButton.addEventListener('click', () => {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentDrillSet.length) {
                    loadQuestion(currentQuestionIndex);
                } else {
                    showResults();
                }
            });

            restartDrillButton.addEventListener('click', () => {
                const nextSet = (currentDrillSet === drillSetA) ? drillSetB : drillSetA;
                startDrill(nextSet);
            });

            // Initial Start
            startDrill(drillSetA);


            // Casualty Chart
            const ctx = document.getElementById('casualtyChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['最優先治療群 (赤)', '待機的治療群 (黄)', '軽処置群 (緑)', '不処置群 (黒)'],
                    datasets: [{
                        label: '傷病者分布',
                        data: [15, 25, 50, 10],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(55, 65, 81, 0.8)'
                        ],
                        borderColor: ['#ef4444', '#f59e0b', '#22c55e', '#374151'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: '想定傷病者割合 (%)' }
                    }
                }
            });
        });
    </script>
</body>
</html>

