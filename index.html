<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多数傷病者対応 教育・訓練アプリケーション</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Emergency Response -->
    <!-- Application Structure Plan: 本アプリケーションは、リニアなスライド形式ではなく、テーマ別のセクションに分かれたSPA（シングルページアプリケーション）構造を採用しました。理由は、学習者が全体の流れを把握しつつ、必要な項目へすぐにアクセスできる利便性を提供するためです。構成は「基礎知識」→「初動対応フロー（インタラクティブ）」→「トリアージ訓練（実践）」→「具体的シナリオ」→「参考情報」と段階的に理解が深まるように設計されています。この構造により、体系的な学習と、現場でのクイックリファレンスの両方のニーズに応えることを目指しました。 -->
    <!-- Visualization & Content Choices: 報告書情報 -> 目標 -> 可視化/表現方法 -> インタラクション -> 正当化 -> ライブラリ/手法
1. 初動対応手順 -> 整理/情報提供 -> HTML/CSSによるインタラクティブなフローチャート -> クリックで詳細表示 -> 複雑なプロセスを段階的に学習可能にするため -> Tailwind CSS
2. トリアージカテゴリー別人数 -> 比較/情報提供 -> ドーナツグラフ -> ホバーで詳細表示 -> 事案の全体像（重症度分布）を視覚的に素早く把握するため -> Chart.js
3. 傷病者評価 -> 学習定着 -> クイズ形式のインタラクティブカード -> ボタンクリックでトリアージタッグを選択 -> 受動的な学習より能動的な実践が記憶定着に繋がるため -> Vanilla JS
4. 岡崎中央総合公園の現場配置 -> 整理/情報提供 -> HTML/CSS Divによる簡易図 -> クリックで情報表示 -> 画像や外部ライブラリに依存せず、特定のシナリオにおける空間的関係を理解しやすくするため -> Tailwind CSS
5. 近隣医療機関リスト -> 情報提供/参照 -> HTMLテーブル -> フィルタリング機能 -> 緊急時に必要な情報を迅速に絞り込めるようにするため -> Vanilla JS -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8f9fa;
        }
        .section-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s, color 0.3s;
            cursor: pointer;
            color: #4b5563;
        }
        .nav-link.active {
            background-color: #1e40af;
            color: white;
            font-weight: 700;
        }
        .flowchart-step {
            border: 2px solid #e5e7eb;
            padding: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .flowchart-step:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .flowchart-step .details {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
        }
        .flowchart-arrow {
            font-size: 2rem;
            color: #9ca3af;
        }
        .triage-tag {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .triage-tag:hover {
            transform: scale(1.05);
        }
        .tag-red { background-color: #ef4444; color: white; }
        .tag-yellow { background-color: #f59e0b; color: white; }
        .tag-green { background-color: #22c55e; color: white; }
        .tag-black { background-color: #374151; color: white; }
        .feedback-correct { color: #22c55e; }
        .feedback-incorrect { color: #ef4444; }
        .venue-map-item {
            border: 2px dashed #9ca3af;
            padding: 1rem;
            text-align: center;
            border-radius: 0.5rem;
            font-weight: bold;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: auto;
            max-height: 400px;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-blue-800">多数傷病者対応 教育・訓練アプリ</h1>
            <div class="hidden md:flex space-x-2">
                <a href="#intro" class="nav-link">はじめに</a>
                <a href="#basics" class="nav-link">基礎知識</a>
                <a href="#flow" class="nav-link">初動対応フロー</a>
                <a href="#drill" class="nav-link">トリアージ訓練</a>
                <a href="#scenario" class="nav-link">岡崎市シナリオ</a>
                <a href="#hospitals" class="nav-link">近隣医療機関</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <a href="#intro" class="block py-2 px-4 text-sm nav-link">はじめに</a>
            <a href="#basics" class="block py-2 px-4 text-sm nav-link">基礎知識</a>
            <a href="#flow" class="block py-2 px-4 text-sm nav-link">初動対応フロー</a>
            <a href="#drill" class="block py-2 px-4 text-sm nav-link">トリアージ訓練</a>
            <a href="#scenario" class="block py-2 px-4 text-sm nav-link">岡崎市シナリオ</a>
            <a href="#hospitals" class="block py-2 px-4 text-sm nav-link">近隣医療機関</a>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <section id="intro" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">はじめに：大規模イベントに備えて</h2>
            <p class="mb-4">
                本教育資料は、消防署に勤務する救急救命士を対象とし、多数傷病者発生事案における標準的な初動対応能力の向上を目的としています。
            </p>
            <p>
                特に、2026年に開催される愛知・名古屋アジアパラ競技大会では、岡崎市も競技会場の一つとなります。国内外から多くの人々が集まる大規模イベントでは、万が一の事態に備え、迅速かつ組織的な対応が求められます。このアプリケーションを通じて、基礎知識の再確認と、具体的なシナリオを想定したシミュレーションを行い、万全の体制を整えましょう。
            </p>
        </section>

        <section id="basics" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">基礎知識：多数傷病者対応の原則</h2>
            <p class="mb-6">多数傷病者対応とは、単一の事故や災害で、地域の医療供給能力を上回る数の傷病者が発生した状態への対応を指します。限られた医療資源を最大限に活用し、救命率の向上を目指すことが最大の目標です。「防ぎ得た災害死」をなくすため、以下の原則に基づき活動します。</p>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2 text-blue-800">CSCA TTT フレームワーク</h3>
                    <p class="text-sm">現場活動を体系的に進めるための指揮・管理の枠組みです。</p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li><strong>C</strong> - Command & Control（指揮・統制）</li>
                        <li><strong>S</strong> - Safety（安全確保）</li>
                        <li><strong>C</strong> - Communication（情報伝達・通信）</li>
                        <li><strong>A</strong> - Assessment（状況評価）</li>
                        <li><strong>T</strong> - Triage（トリアージ）</li>
                        <li><strong>T</strong> - Treatment（治療）</li>
                        <li><strong>T</strong> - Transport（搬送）</li>
                    </ul>
                </div>
                <div class="bg-amber-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2 text-amber-800">トリアージとは</h3>
                    <p class="text-sm">傷病者の重症度と緊急性に基づき、治療と搬送の優先順位を決定することです。START法（Simple Triage and Rapid Treatment）が一般的に用いられます。</p>
                    <div class="mt-3 grid grid-cols-2 gap-2">
                        <div class="flex items-center"><span class="tag-red mr-2">🔴</span>第I順位（最優先治療群）</div>
                        <div class="flex items-center"><span class="tag-yellow mr-2">🟡</span>第II順位（待機的治療群）</div>
                        <div class="flex items-center"><span class="tag-green mr-2">🟢</span>第III順位（軽処置群）</div>
                        <div class="flex items-center"><span class="tag-black mr-2">⚫️</span>第0順位（不処置群/死亡群）</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="flow" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">初動対応フロー：最初の10分間の行動</h2>
            <p class="mb-6">災害現場に最初に到着した救急隊（先着隊）の行動が、その後の活動全体を大きく左右します。以下のステップを確実に行いましょう。各ステップをクリックすると、詳細な行動内容と読み上げ原稿例が表示されます。</p>
            <div class="space-y-4">
                <div id="step1" class="flowchart-step">
                    <h3 class="font-bold text-lg">ステップ1：状況評価と安全確保 (Assessment & Safety)</h3>
                    <div class="details">
                        <p class="font-semibold">【行動内容】</p>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li>車両を安全な位置に停車させる（二次災害の危険がない場所、後続隊の妨げにならない場所）。</li>
                            <li>現場のハザード（火災、漏洩、崩壊など）を確認し、隊員の安全を最優先する。</li>
                            <li>風向、地形などを考慮する。</li>
                            <li>傷病者の概数を把握する（例：「10名以上」「約20名」）。</li>
                        </ul>
                        <p class="font-semibold mt-3">【読み上げ原稿例】</p>
                        <p class="text-sm p-2 bg-gray-100 rounded">『隊長、現場の安全確認。二次災害の危険なし。傷病者は広範囲に約20名。重傷者多数の模様。』</p>
                    </div>
                </div>
                <div class="text-center flowchart-arrow">⬇️</div>
                <div id="step2" class="flowchart-step">
                    <h3 class="font-bold text-lg">ステップ2：災害発生宣言と第一報 (Declaration & Communication)</h3>
                    <div class="details">
                        <p class="font-semibold">【行動内容】</p>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li>無線で「多数傷病者発生事案」であることを宣言する。</li>
                            <li>簡潔明瞭に、必要な情報を盛り込み第一報を送信する (METHANE report)。</li>
                            <li><strong>M</strong> (Major incident declaration): 多数傷病者事案発生</li>
                            <li><strong>E</strong> (Exact location): 正確な場所</li>
                            <li><strong>T</strong> (Type of incident): 事案種別（例：列車脱線、爆発）</li>
                            <li><strong>H</strong> (Hazards): 危険有害物の有無</li>
                            <li><strong>A</strong> (Access): 現場への進入経路</li>
                            <li><strong>N</strong> (Number of casualties): 傷病者数</li>
                            <li><strong>E</strong> (Emergency services): 他に必要な機関（警察、消防、DMAT等）</li>
                        </ul>
                         <p class="font-semibold mt-3">【読み上げ原稿例】</p>
                        <p class="text-sm p-2 bg-gray-100 rounded">『こちら岡崎救急1、司令センター。岡崎市〇〇町、アジアパラ大会会場で多数傷病者事案発生。種別は爆発。二次災害の危険は今のところなし。国道1号線から進入可能。傷病者約20名。全救急隊、消防隊、DMATの出動を要請する。』</p>
                    </div>
                </div>
                <div class="text-center flowchart-arrow">⬇️</div>
                <div id="step3" class="flowchart-step">
                    <h3 class="font-bold text-lg">ステップ3：指揮本部と各エリアの設定 (Command & Control)</h3>
                    <div class="details">
                        <p class="font-semibold">【行動内容】</p>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li>先着隊の隊長が現場指揮官（IC）となる。</li>
                            <li>後続隊が視認しやすいように、指揮本部（CP）の位置を決定し、宣言する。</li>
                            <li>安全な場所に、トリアージエリア、救護所（赤・黄）、搬送エリアを設定する。</li>
                            <li>後続隊の集結場所（ステージングエリア）を指定する。</li>
                        </ul>
                        <p class="font-semibold mt-3">【読み上げ原稿例】</p>
                        <p class="text-sm p-2 bg-gray-100 rounded">『岡崎救急1が現場指揮官となる。指揮本部を車両位置に設置。後続隊は会場東側駐車場に集結せよ。』</p>
                    </div>
                </div>
                <div class="text-center flowchart-arrow">⬇️</div>
                <div id="step4" class="flowchart-step">
                    <h3 class="font-bold text-lg">ステップ4：トリアージの開始 (Triage)</h3>
                    <div class="details">
                        <p class="font-semibold">【行動内容】</p>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li>原則として、先着隊の隊長は指揮に専念し、他の隊員がトリアージを開始する。</li>
                            <li>START法に基づき、迅速に評価を進める。「歩けるか？」「呼吸は？」「循環は？」「意識は？」</li>
                            <li>トリアージタッグを傷病者の右手首に装着する。</li>
                            <li>「赤」エリアへの搬送を優先的に開始する。</li>
                        </ul>
                         <p class="font-semibold mt-3">【読み上げ原稿例】</p>
                        <p class="text-sm p-2 bg-gray-100 rounded">『これよりトリアージを開始する。歩ける方はこちらの緑のシートに集まってください！』</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="drill" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">トリアージ訓練：START法に基づく判断</h2>
            <p class="mb-6">以下の傷病者の状態を読み、適切なトリアージタッグを選択してください。選択後に解説が表示されます。</p>
            <div id="triage-drill-container" class="space-y-6"></div>
            <div class="text-center mt-6">
                <button id="next-drill-button" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">次の問題へ</button>
            </div>
        </section>

        <section id="scenario" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">岡崎市特設シナリオ：アジアパラ大会会場での事案発生</h2>
            <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-r-lg mb-6">
                <h3 class="font-bold">【事案概要】</h3>
                <p>岡崎中央総合公園 総合体育館、車いすバスケットボール競技の観客席エリアで原因不明の爆発が発生。多数の傷病者が発生している模様。</p>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-bold text-lg mb-2">特有の考慮事項</h3>
                    <ul class="list-disc list-inside space-y-2">
                        <li><strong>多様な傷病者:</strong> アスリート、観客、大会関係者など。特に、障がいを持つ方々への対応（コミュニケーション、移動補助）に配慮が必要。</li>
                        <li><strong>会場構造:</strong> 体育館の出入口、通路、避難経路を把握し、搬送ルートを迅速に確保する。</li>
                        <li><strong>情報錯綜:</strong> 大規模イベントのため、デマやパニックが発生しやすい。公式な情報伝達ルートを早期に確立する。</li>
                        <li><strong>通信:</strong> 携帯電話網の輻輳が予想されるため、消防無線が主要な通信手段となる。</li>
                    </ul>
                    <h3 class="font-bold text-lg mt-6 mb-2">想定される傷病者分布（ドーナツグラフ）</h3>
                    <p class="text-sm mb-4">このような大規模事案では、比較的軽症者が多くなる傾向がありますが、重症者への対応を最優先する必要があります。</p>
                    <div class="chart-container">
                        <canvas id="casualtyChart"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-2">現場活動エリア設定案</h3>
                    <p class="text-sm mb-4">体育館の構造と周辺地理を考慮したエリア設定例です。</p>
                    <div class="bg-gray-100 p-4 rounded-lg space-y-4">
                        <div class="venue-map-item bg-blue-100 border-blue-400">指揮本部 (CP) - 体育館正面入口付近</div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="venue-map-item bg-gray-200 border-gray-400">ステージングエリア - 第1駐車場</div>
                            <div class="venue-map-item bg-purple-100 border-purple-400">搬送待機エリア - 体育館東側</div>
                        </div>
                        <div class="venue-map-item bg-orange-100 border-orange-400">救護所（赤・黄エリア）- 体育館隣接の武道館</div>
                        <div class="venue-map-item bg-green-100 border-green-400">軽傷者エリア（緑エリア）- 弓道場前の広場</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="hospitals" class="section-card scroll-mt-20">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">岡崎市および近隣の主要救急医療機関</h2>
            <p class="mb-6">多数傷病者発生時には、司令センターの指示に基づき、各医療機関へ傷病者を分散搬送します。現場から比較的近く、三次救急や重症者対応が可能な主要機関を把握しておくことが重要です。</p>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="p-3 font-bold uppercase text-gray-600 border border-gray-300">医療機関名</th>
                            <th class="p-3 font-bold uppercase text-gray-600 border border-gray-300">所在地</th>
                            <th class="p-3 font-bold uppercase text-gray-600 border border-gray-300">特記事項</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">藤田医科大学 岡崎医療センター</td>
                            <td class="p-3 border border-gray-300">岡崎市</td>
                            <td class="p-3 border border-gray-300">救命救急センター（三次救急）</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">岡崎市民病院</td>
                            <td class="p-3 border border-gray-300">岡崎市</td>
                            <td class="p-3 border border-gray-300">地域救命救急センター（三次救急）</td>
                        </tr>
                         <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">安城更生病院</td>
                            <td class="p-3 border border-gray-300">安城市</td>
                            <td class="p-3 border border-gray-300">救命救急センター（三次救急）</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">豊田厚生病院</td>
                            <td class="p-3 border border-gray-300">豊田市</td>
                            <td class="p-3 border border-gray-300">救命救急センター（三次救急）</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 border border-gray-300">トヨタ記念病院</td>
                            <td class="p-3 border border-gray-300">豊田市</td>
                            <td class="p-3 border border-gray-300">救命救急センター（三次救急）</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white text-center py-4 mt-8">
        <p>&copy; 2025 消防署 救急課 教育資料</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Mobile Menu Toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // Smooth scrolling and active nav link highlighting
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('section');
            
            const activateLink = (id) => {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${id}`) {
                        link.classList.add('active');
                    }
                });
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        activateLink(entry.target.id);
                    }
                });
            }, { rootMargin: '-50% 0px -50% 0px' });

            sections.forEach(section => {
                observer.observe(section);
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    document.querySelector(targetId).scrollIntoView({
                        behavior: 'smooth'
                    });
                    if (mobileMenu.classList.contains('hidden') === false) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

            // Flowchart interaction
            const flowchartSteps = document.querySelectorAll('.flowchart-step');
            flowchartSteps.forEach(step => {
                step.addEventListener('click', () => {
                    const details = step.querySelector('.details');
                    const isVisible = details.style.display === 'block';
                    // Hide all details first
                    document.querySelectorAll('.flowchart-step .details').forEach(d => d.style.display = 'none');
                    // Toggle current one
                    details.style.display = isVisible ? 'none' : 'block';
                });
            });

            // Triage Drill
            const drillData = [
                { 
                    scenario: "30代男性、呼びかけに開眼するが混乱している。呼吸数32回/分。橈骨動脈で脈拍を触知可能。歩行はできない。",
                    correct: "red",
                    explanation: "意識レベルが低下しており、呼吸数も30回/分を超えているため、最優先治療群（赤）となります。"
                },
                {
                    scenario: "小学生女児、広範囲の熱傷で泣き叫んでいる。呼吸は正常、橈骨動脈で脈拍は触れる。指示に従うことはできないが、払いのけるなどの動作はみられる。",
                    correct: "red",
                    explanation: "広範囲熱傷は重症であり、小児であることも考慮すると生理学的に不安定になる可能性が高いです。現状ではバイタルは安定しているかもしれませんが、緊急治療が必要なため最優先治療群（赤）と判断します。"
                },
                {
                    scenario: "70代女性、瓦礫の下に下半身が挟まれている。呼びかけに反応なし。気道確保するも自発呼吸が見られない。",
                    correct: "black",
                    explanation: "気道を確保しても自発呼吸がない場合、START法では不処置/死亡群（黒）と判断されます。"
                },
                {
                    scenario: "20代女性、右腕の変形を訴え、強い痛みで動けない。会話は明瞭。呼吸・脈拍は正常。",
                    correct: "yellow",
                    explanation: "歩行はできないが、生命の危機は直ちにはありません。待機的治療が可能なため、待機的治療群（黄）となります。"
                },
                {
                    scenario: "40代男性、額から少量の出血があるが、呼びかけに応じ、自力で歩行可能。",
                    correct: "green",
                    explanation: "自力で歩行できる傷病者は、原則として軽処置群（緑）に分類されます。"
                }
            ];

            let currentDrillIndex = 0;
            const drillContainer = document.getElementById('triage-drill-container');
            const nextDrillButton = document.getElementById('next-drill-button');

            function loadDrill(index) {
                drillContainer.innerHTML = '';
                const item = drillData[index];
                
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-lg shadow';

                const scenarioText = document.createElement('p');
                scenarioText.className = 'mb-4';
                scenarioText.textContent = `【症例 ${index + 1}】 ${item.scenario}`;
                card.appendChild(scenarioText);

                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'flex flex-wrap gap-2 justify-center';
                
                const tags = [
                    { id: 'red', text: '🔴 最優先' },
                    { id: 'yellow', text: '🟡 待機的' },
                    { id: 'green', text: '🟢 軽処置' },
                    { id: 'black', text: '⚫️ 不処置' }
                ];

                tags.forEach(tag => {
                    const button = document.createElement('button');
                    button.dataset.tag = tag.id;
                    button.innerHTML = tag.text;
                    button.className = `triage-tag tag-${tag.id}`;
                    buttonContainer.appendChild(button);
                });
                card.appendChild(buttonContainer);

                const feedback = document.createElement('div');
                feedback.className = 'mt-4 text-center font-bold';
                card.appendChild(feedback);
                
                const explanation = document.createElement('p');
                explanation.className = 'mt-2 text-sm bg-gray-50 p-3 rounded-lg hidden';
                card.appendChild(explanation);

                drillContainer.appendChild(card);

                buttonContainer.addEventListener('click', (e) => {
                    if (e.target.matches('button')) {
                        const selectedTag = e.target.dataset.tag;
                        if (selectedTag === item.correct) {
                            feedback.textContent = '正解です！';
                            feedback.className = 'mt-4 text-center font-bold feedback-correct';
                        } else {
                            feedback.textContent = `不正解。正解は「${tags.find(t=>t.id === item.correct).text}」です。`;
                            feedback.className = 'mt-4 text-center font-bold feedback-incorrect';
                        }
                        explanation.textContent = item.explanation;
                        explanation.classList.remove('hidden');
                        
                        // Disable buttons after selection
                        buttonContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);
                    }
                });
            }

            nextDrillButton.addEventListener('click', () => {
                currentDrillIndex = (currentDrillIndex + 1) % drillData.length;
                loadDrill(currentDrillIndex);
            });

            loadDrill(currentDrillIndex);


            // Casualty Chart
            const ctx = document.getElementById('casualtyChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['最優先治療群 (赤)', '待機的治療群 (黄)', '軽処置群 (緑)', '不処置群 (黒)'],
                    datasets: [{
                        label: '傷病者分布',
                        data: [15, 25, 55, 5],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(55, 65, 81, 0.8)'
                        ],
                        borderColor: [
                            '#ef4444',
                            '#f59e0b',
                            '#22c55e',
                            '#374151'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: '想定傷病者割合 (%)'
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
